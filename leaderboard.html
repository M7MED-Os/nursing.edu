<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ† | Ø«Ø§Ù†ÙˆÙŠØ©.ÙƒÙˆÙ…</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .leaderboard-hero {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            padding: clamp(2rem, 8vw, 4rem) 0;
            text-align: center;
            margin-bottom: -3rem;
            position: relative;
            z-index: 1;
        }

        .leaderboard-hero h1 {
            font-size: clamp(1.8rem, 5vw, 3rem);
            margin-bottom: 0.5rem;
        }

        .leaderboard-hero p {
            font-size: clamp(0.9rem, 3vw, 1.1rem);
            opacity: 0.9;
        }

        .leaderboard-container {
            max-width: 800px;
            margin: 0 auto 4rem auto;
            position: relative;
            z-index: 2;
            padding: 0 1rem;
        }

        .full-leaderboard-card {
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            border: 1px solid #E5E7EB;
        }

        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
        }

        .leaderboard-table th {
            background: #f8fafc;
            padding: 1.25rem 0.75rem;
            text-align: right;
            color: #64748b;
            font-size: clamp(0.75rem, 2vw, 0.9rem);
            font-weight: 700;
            border-bottom: 2px solid #f1f5f9;
        }

        .leaderboard-table td {
            padding: clamp(0.75rem, 3vw, 1.25rem) 0.5rem;
            border-bottom: 1px solid #f1f5f9;
            vertical-align: middle;
        }

        .rank-cell {
            width: 60px;
            text-align: center;
            font-weight: 900;
            font-size: clamp(1rem, 3vw, 1.2rem);
            color: #94a3b8;
        }

        .rank-1 {
            color: #d97706;
        }

        .rank-2 {
            color: #d97706;
            /* Goldish */
        }

        .rank-3 {
            color: #94a3b8;
            /* Silverish */
        }

        .medal-icon {
            font-size: clamp(1.2rem, 4vw, 1.5rem);
            margin-left: 5px;
        }

        .user-info-cell {
            display: flex;
            align-items: center;
            gap: clamp(8px, 2vw, 15px);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: #f1f5f9;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            color: var(--primary-color);
            border: 2px solid white;
            box-shadow: var(--shadow-sm);
            flex-shrink: 0;
        }

        .user-name-box b {
            display: block;
            font-size: clamp(0.85rem, 2.5vw, 1.1rem);
            color: var(--text-dark);
            line-height: 1.2;
        }

        .user-name-box span {
            font-size: clamp(0.7rem, 2vw, 0.8rem);
            color: var(--text-light);
            display: block;
            margin-top: 2px;
        }

        .points-cell {
            text-align: center;
            font-weight: 900;
            font-size: clamp(1rem, 3vw, 1.3rem);
            color: var(--primary-color);
            min-width: 60px;
        }

        .points-label {
            display: block;
            font-size: 0.65rem;
            color: #94a3b8;
            font-weight: 400;
            margin-top: 2px;
        }

        .admin-badge {
            background: #fefce8;
            color: #a16207;
            padding: 1px 6px;
            border-radius: 4px;
            font-size: 0.6rem;
            border: 1px solid #fef08a;
            margin-right: 5px;
            display: inline-block;
        }

        @media (max-width: 480px) {
            .user-avatar {
                display: none;
                /* Hide avatar on tiny screens to fit name */
            }

            .rank-cell {
                width: 40px;
            }

            .leaderboard-table td {
                padding: 0.75rem 0.25rem;
            }
        }

        @media (max-width: 640px) {
            .leaderboard-hero {
                margin-bottom: 0;
                padding: 3rem 0;
            }

            .leaderboard-container {
                margin-top: 1rem;
            }
        }
    </style>
</head>

<body>

    <!-- Loading Screen (Disabled to prevent layout shift)
    <div id="loading" class="loading-overlay">
        <div class="spinner"></div>
        <p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
    </div>
    -->

    <!-- Navbar -->
    <nav class="navbar">
        <div class="container">
            <a href="dashboard.html" class="logo">
                <i class="fas fa-graduation-cap"></i>&nbsp;Ø«Ø§Ù†ÙˆÙŠØ©<span>.ÙƒÙˆÙ…</span>
            </a>

            <div class="menu-toggle">
                <i class="fas fa-bars"></i>
            </div>

            <ul class="nav-links">
                <li><a href="dashboard.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                <li><a href="todo.html">Ø§Ù„Ù…Ù‡Ø§Ù…</a></li>
                <li><a href="leaderboard.html" class="active">Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†</a></li>
                <li id="adminNavBtn" style="display: none;">
                    <a href="admin.html" style="color: var(--secondary-color); font-weight: bold;">
                        <i class="fas fa-shield-alt"></i> Admin
                    </a>
                </li>
                <li><a href="profile.html" id="navUserName">Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„</a></li>
                <li><button id="logoutBtn" class="btn btn-outline" style="padding: 0.5rem 1rem;">Ø®Ø±ÙˆØ¬</button></li>
            </ul>
        </div>
    </nav>

    <!-- Header Section -->
    <header class="leaderboard-hero">
        <div class="container">
            <h1>ğŸ† Ù„ÙˆØ­Ø© Ø§Ù„Ø´Ø±Ù</h1>
            <p>Ø£ÙØ¶Ù„ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ù†ØµØ© ÙƒÙØ§Ø­Ø§Ù‹ ÙˆØªÙ‚Ø¯ÙŠØ±Ø§Ù‹</p>
        </div>
    </header>

    <!-- Leaderboard Table -->
    <div class="container leaderboard-container">
        <div class="full-leaderboard-card">
            <table class="leaderboard-table">
                <thead>
                    <tr>
                        <th style="text-align: center;">Ø§Ù„ØªØ±ØªÙŠØ¨</th>
                        <th>Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                        <th style="text-align: center;">Ø§Ù„Ù†Ù‚Ø§Ø·</th>
                    </tr>
                </thead>
                <tbody id="leaderboardBody">
                    <!-- Loaded via JS -->
                    <tr>
                        <td colspan="3" style="text-align: center; padding: 4rem;">
                            <i class="fas fa-spinner fa-spin fa-2x" style="color: var(--primary-color);"></i>
                            <p style="margin-top: 1rem; color: var(--text-light);">Ø¬Ø§Ø±ÙŠ ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„...</p>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="copyright" style="border: none; padding-top: 0;">
                <p>&copy; 2026 Ø«Ø§Ù†ÙˆÙŠØ©.ÙƒÙˆÙ…</p>
            </div>
        </div>
    </footer>

    <script src="assets/js/main.js"></script>
    <script type="module" src="assets/js/auth.js"></script>
    <script type="module">
        import { supabase } from "./assets/js/supabaseClient.js";

        async function loadLeaderboardPage() {
            const body = document.getElementById('leaderboardBody');

            try {
                // Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø¹Ø¯Ø¯: ØºÙŠØ± Ø§Ù„Ø±Ù‚Ù… (50) Ù„Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ù„ÙŠ ØªØ­Ø¨Ù‡
                const { data, error } = await supabase
                    .from('profiles')
                    .select('full_name, points, grade, role')
                    .order('points', { ascending: false })
                    .limit(10);

                if (error) throw error;

                const gradeMap = { "1": "Ø£ÙˆÙ„Ù‰ Ø«Ø§Ù†ÙˆÙŠ", "2": "ØªØ§Ù†ÙŠØ© Ø«Ø§Ù†ÙˆÙŠ", "3": "ØªØ§Ù„ØªØ© Ø«Ø§Ù†ÙˆÙŠ" };

                body.innerHTML = data.map((s, i) => {
                    const rank = i + 1;
                    let rankDisplay = rank;
                    let rankClass = `rank-${rank}`;

                    if (rank === 1) rankDisplay = '<i class="fas fa-crown medal-icon"></i>';
                    else if (rank === 2) rankDisplay = '<i class="fas fa-medal medal-icon" style="color:#d97706"></i>'; // Gold
                    else if (rank === 3) rankDisplay = '<i class="fas fa-medal medal-icon" style="color:#94a3b8"></i>'; // Silver
                    else rankClass = '';

                    return `
                        <tr>
                            <td class="rank-cell ${rankClass}">${rankDisplay}</td>
                            <td>
                                <div class="user-info-cell">
                                    <div class="user-avatar">${s.full_name[0]}</div>
                                    <div class="user-name-box">
                                        <b>${s.full_name}</b>
                                        <span>${gradeMap[s.grade] || '-'}</span>
                                    </div>
                                </div>
                            </td>
                            <td class="points-cell">
                                ${s.points || 0}
                                <span class="points-label">Ù†Ù‚Ø·Ø©</span>
                            </td>
                        </tr>
                    `;
                }).join('');

            } catch (err) {
                console.error(err);
                body.innerHTML = '<tr><td colspan="3" style="text-align:center; color:red; padding: 2rem;">ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>';
            } finally {
                // Safety: Ensure any global loading spinner is hidden
                const globalLoading = document.getElementById('loading');
                if (globalLoading) {
                    globalLoading.style.opacity = '0';
                    setTimeout(() => { if (globalLoading.parentNode) globalLoading.remove(); }, 500);
                }
            }
        }

        window.addEventListener('DOMContentLoaded', loadLeaderboardPage);
    </script>

</body>

</html>